<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Traducciones ‚Äî DBTeam</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/static/style.css" />
  <link rel="stylesheet" href="/static/shared.css" />
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <style>
    :root {
      --accent: #2563eb;
      --accent-2: #7c3aed;
      --bg: #071028;
      --card: #0b1220;
      --text: #e6eef8;
      --muted: #b0b8c9;
    }
    [data-theme="light"] {
      --bg: #f4f7fb;
      --card: #fff;
      --text: #1a2233;
      --muted: #6b7280;
    }
    body {
      background: linear-gradient(180deg, var(--bg), #021021);
      color: var(--text);
      transition: background 0.3s, color 0.3s;
      font-family: Inter, Arial, sans-serif;
    }
    .site-header {
      background: var(--card);
      box-shadow: 0 2px 8px rgba(31,38,135,0.08);
    }
    .main-nav a, .header-actions a {
      color: var(--accent);
      font-weight: 600;
      text-decoration: none;
      margin-right: 12px;
      transition: color 0.2s;
    }
    .main-nav a:hover, .header-actions a:hover {
      color: var(--accent-2);
    }
    [data-theme="light"] .main-nav a, [data-theme="light"] .header-actions a {
      color: #2563eb;
    }
    [data-theme="light"] .main-nav a:hover, [data-theme="light"] .header-actions a:hover {
      color: #7c3aed;
    }
    .theme-toggle-btn {
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 6px 14px;
      margin-left: 10px;
      cursor: pointer;
      font-weight: 600;
      transition: background 0.2s;
    }
    .theme-toggle-btn:hover {
      background: var(--accent-2);
    }
  </style>
</head>
<body>
  <header class="site-header">
    <aside id="notificationSidebar" style="position:fixed;right:-340px;top:0;height:100vh;width:320px;background:var(--card,#181f2a);box-shadow:-2px 0 8px #0002;z-index:1000;transition:right 0.3s;overflow-y:auto;padding:18px 16px 16px 16px;display:flex;flex-direction:column;gap:12px">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <span style="font-weight:700;font-size:1.2rem">Notificaciones</span>
        <button id="closeSidebarBtn" class="btn ghost" style="font-size:1.2rem">√ó</button>
      </div>
      <div style="margin-bottom:12px">
        <label for="tgChannelInput" style="font-size:0.95rem;color:#888">Canal Telegram para notificaciones</label>
        <input id="tgChannelInput" type="text" placeholder="@micanal o -100123456789" style="width:100%;margin-top:4px" />
        <button id="saveTgChannelBtn" class="btn" style="margin-top:6px">Guardar canal</button>
        <span id="tgChannelStatus" style="margin-left:8px;color:#888"></span>
      </div>
      <div id="notificationList"></div>
    </aside>
    <button id="openSidebarBtn" style="position:fixed;right:12px;top:60px;z-index:1001;background:var(--owner-color,#1e90ff);color:#fff;border:none;border-radius:8px;padding:10px 16px;font-size:1.1rem;box-shadow:0 2px 8px #0002;cursor:pointer">üîî</button>
    <div class="header-inner">
      <a class="brand" href="index.html"><img src="logo.svg" class="logo" alt="DBTeam"/> <span>DBTeam</span></a>
      <nav class="main-nav" aria-label="Main navigation">
        <a href="index.html">Inicio</a>
        <a href="chat.html">Chat</a>
        <a href="telegram.html">Telegram</a>
        <a href="monitor.html">Monitor</a>
        <a href="traducciones.html">Traducciones</a>
        <button id="forceTranslateBtn" style="display:none;margin-left:12px">Forzar traducci√≥n autom√°tica</button>
        <a href="links.html">Enlaces</a>
        <a href="status.html">Estado</a>
        <a href="bot_settings.html">Bots</a>
        <a href="owner.html">Owner</a>
      </nav>
      <div class="header-actions">
        <a href="login.html" class="btn">Login</a>
        <a href="register.html" class="btn ghost">Registro</a>
      </div>
      <button class="nav-toggle" aria-label="Abrir men√∫">‚ò∞</button>
    </div>
  </header>
  <script>
    // Tema: claro/oscuro con persistencia
    function setTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      localStorage.setItem('theme', theme);
      var btn = document.getElementById('themeToggleBtn');
      if (btn) btn.textContent = theme === 'light' ? 'üåô' : '‚òÄÔ∏è';
    }
    function toggleTheme() {
      const current = document.documentElement.getAttribute('data-theme') || 'dark';
      setTheme(current === 'dark' ? 'light' : 'dark');
    }
    document.addEventListener('DOMContentLoaded', function() {
      const saved = localStorage.getItem('theme') || 'dark';
      setTheme(saved);
      var btn = document.getElementById('themeToggleBtn');
      if (btn) btn.addEventListener('click', toggleTheme);
    });
  </script>

  <main class="container">
    <!-- Panel de login obligatorio -->
    <section id="loginPanel" style="margin-bottom:18px;border:1px solid #444;padding:18px;border-radius:10px;background:#181818;max-width:420px;display:none">
      <h2>Login requerido</h2>
      <div style="margin-bottom:10px;display:flex;flex-direction:column;gap:10px">
        <input id="loginUserInput" type="text" placeholder="Usuario" style="width:100%" />
        <input id="loginPassInput" type="password" placeholder="Contrase√±a" style="width:100%" />
        <button id="loginBtn">Entrar</button>
        <span id="loginMsg" style="margin-top:8px;color:#f44"></span>
      </div>
      <div id="telegramContact" style="margin-top:14px;color:#6cf;font-size:0.98rem"></div>
    </section>
    <div id="mainContent" style="display:none">
                    <!-- Opci√≥n para enviar traducci√≥n por Telegram (solo admins de traducciones) -->
                    <div id="sendTranslationTelegramPanel" style="display:none;margin-bottom:18px;border:1px solid #444;padding:12px;border-radius:8px;background:#181818;max-width:420px;">
                      <h2>Enviar traducci√≥n por Telegram</h2>
                      <input id="translationTelegramInput" type="text" placeholder="Texto a traducir y enviar..." style="width:100%;margin-bottom:8px" />
                      <div style="margin-bottom:8px">
                        <label><input type="radio" name="tgSendMode" id="tgSendGroup" value="group" checked /> Grupo oficial</label>
                        <label style="margin-left:18px"><input type="radio" name="tgSendMode" id="tgSendPrivate" value="private" /> Privado</label>
                        <input id="tgPrivateUserInput" type="text" placeholder="Usuario Telegram (ej: @usuario)" style="width:60%;margin-left:12px;display:none" />
                      </div>
                      <button id="sendTranslationTelegramBtn" class="btn">Enviar por Telegram</button>
                      <span id="sendTranslationTelegramMsg" style="margin-left:10px;color:#6cf"></span>
                    </div>
              <!-- Opci√≥n para contactar con el creador, solo admins -->
              <div id="contactCreatorPanel" style="display:none;margin-bottom:18px;border:1px solid #444;padding:12px;border-radius:8px;background:#181818;max-width:420px;">
                        <div style="margin-bottom:10px">
                          <button id="notifyCreatorTelegramBtn" class="btn" style="margin-right:8px">Notificar por Telegram</button>
                          <button id="notifyCreatorEmailBtn" class="btn">Notificar por Email</button>
                        </div>
                <h2>Minichat con el creador</h2>
                <div id="creatorContactInfo" style="margin-bottom:10px;color:#6cf;font-size:0.98rem"></div>
                <div id="miniChatMessages" style="background:#222;padding:8px 10px;border-radius:8px;min-height:60px;max-height:180px;overflow-y:auto;margin-bottom:10px;font-size:0.97rem"></div>
                <div style="display:flex;gap:8px;align-items:center;">
                  <input id="miniChatInput" type="text" placeholder="Escribe tu mensaje..." style="flex:1;padding:6px;border-radius:6px;border:1px solid #444;background:#181818;color:#fff" />
                  <label style="color:#6cf;font-size:0.97rem"><input type="checkbox" id="notifyTelegramChk" /> Telegram</label>
                  <label style="color:#6cf;font-size:0.97rem"><input type="checkbox" id="notifyEmailChk" /> Email</label>
                  <button id="miniChatSendBtn" class="btn">Enviar</button>
                </div>
                <span id="miniChatStatus" style="margin-top:8px;color:#6cf"></span>
              </div>
        <section id="adminCreate" style="display:none;margin-bottom:18px;border:1px solid #444;padding:12px;border-radius:8px;background:#181818;">
          <h2>Crear administrador</h2>
          <div style="margin-bottom:10px;display:flex;gap:12px;flex-wrap:wrap">
            <input id="adminUserInput" type="text" placeholder="Usuario" style="width:120px" />
            <input id="adminPassInput" type="password" placeholder="Contrase√±a" style="width:120px" />
            <button id="adminCreateBtn">Crear</button>
            <span id="adminCreateMsg" style="margin-left:10px;color:#6c6"> </span>
          </div>
        </section>
    <h1>Traducciones</h1>
    <p class="hint">Explora y descarga los archivos de traducci√≥n generados para la interfaz web.</p>

    <section id="ownerAudit" style="display:none;margin-bottom:18px;border:1px solid #444;padding:12px;border-radius:8px;background:#181818;">
      <h2>Auditor√≠a de acciones sensibles</h2>
      <div style="margin-bottom:10px;display:flex;gap:12px;flex-wrap:wrap">
        <input id="auditUserFilter" type="text" placeholder="Usuario" style="width:120px" />
        <input id="auditIpFilter" type="text" placeholder="IP" style="width:120px" />
        <select id="auditActionFilter">
          <option value="">Todas</option>
          <option value="CREATE">CREATE</option>
          <option value="LIST">LIST</option>
          <option value="DENIED_CREATE">DENIED_CREATE</option>
          <option value="DENIED_LIST">DENIED_LIST</option>
          <option value="ACCESS">ACCESS</option>
        </select>
        <button id="auditFilterBtn">Filtrar</button>
        <button id="auditClearBtn" class="secondary">Limpiar</button>
        <input id="auditPathFilter" type="text" placeholder="Ruta" style="width:180px" />
      </div>
      <div id="auditList">Solo visible para owner/admin.</div>

      <section id="adminCreate" style="display:none;margin-top:18px;border:1px solid #444;padding:12px;border-radius:8px;background:#181818;">
        <h2>Crear administrador</h2>
        <div style="margin-bottom:10px;display:flex;gap:12px;flex-wrap:wrap">
          <input id="adminUserInput" type="text" placeholder="Usuario" style="width:120px" />
          <input id="adminPassInput" type="password" placeholder="Contrase√±a" style="width:120px" />
          <button id="adminCreateBtn">Crear</button>
          <span id="adminCreateMsg" style="margin-left:10px;color:#6c6"> </span>
        </div>
      </section>
    </section>

    <section style="margin-bottom:18px">
      <label for="newLangInput">Crear nuevo idioma:</label>
      <input id="newLangInput" type="text" maxlength="5" placeholder="C√≥digo ej: fr, de, it" style="width:60px;text-transform:lowercase" />
      <select id="newScopeInput">
        <option value="bot">Bot</option>
        <option value="web">Web (UI)</option>
      </select>
      <button id="createLangBtn">Crear idioma</button>
      <span id="createLangMsg" style="margin-left:10px;color:#6c6"> </span>
    </section>

    <label for="langSelect">Selecciona idioma:</label>

    <div style="display:flex;gap:24px;align-items:center;margin-bottom:8px">
      <div>
        <label for="langSelectWeb">Web:</label>
        <select id="langSelectWeb"></select>
      </div>
      <div>
        <label for="langSelectBot">Bot:</label>
        <select id="langSelectBot"></select>
      </div>
    </div>

    <div style="margin-top:12px;display:flex;gap:8px;align-items:center;">
      <button id="loadBtn">Cargar</button>
      <button id="downloadBtn" class="secondary">Descargar JSON</button>
      <label style="display:flex;align-items:center;gap:6px;margin-left:8px">
        <input type="checkbox" id="editToggle"> Editar
      </label>
      <button id="exportBtn" class="secondary" title="Exportar las traducciones editadas">Exportar edits</button>
      <button id="forceTranslateBtn" style="display:none;margin-left:12px">Forzar traducci√≥n autom√°tica</button>
    </div>
  <script>
  window._isOwner = false;
  async function checkOwner() {
    const token = localStorage.getItem('authToken');
    if (!token) return false;
    const resp = await fetch('/translations/suggestions', { headers: { 'Authorization': 'Bearer ' + token } });
    if (resp.status === 200) {
      document.getElementById('forceTranslateBtn').style.display = '';
      window._isOwner = true;
      return true;
    }
    window._isOwner = false;
    return false;
  }
  checkOwner();
  document.getElementById('forceTranslateBtn').onclick = async function() {
    const token = localStorage.getItem('authToken');
    const scope = document.getElementById('scopeSelect') ? document.getElementById('scopeSelect').value : 'bot';
    const resp = await fetch('/translations/auto', {
      method: 'POST',
      headers: { 'Authorization': 'Bearer ' + token, 'Content-Type': 'application/json' },
      body: JSON.stringify({ scope })
    });
    if (resp.ok) {
      alert('Traducci√≥n autom√°tica iniciada');
    } else {
      alert('No autorizado o error');
    }
  };
  </script>

    <section id="strings" style="margin-top:16px">
      <h2>Claves y traducciones</h2>
      <div id="list"></div>
    </section>

    <section id="suggestions" style="margin-top:24px">
      <h2>Sugerencias pendientes (admin)</h2>
      <div id="suggestList">
        <button id="refreshSuggestions">Refrescar sugerencias</button>
        <div id="suggestionsTable"></div>
      </div>
    </section>

    <footer style="margin-top:24px">
      <small>Archivos generados autom√°ticamente ‚Äî revisa `python_bot/lang/generated/` para la fuente.</small>
    </footer>
  </main>
  <script src="traducciones.js"></script>
  <script src="shared.js"></script>
  <script src="owner.js"></script>
</body>
</html>
