<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chat ‚Äî DBTeam</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/static/style.css" />
  <link rel="stylesheet" href="/static/shared.css" />
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <style>
    :root {
      --accent: #2563eb;
      --accent-2: #7c3aed;
      --bg: #071028;
      --card: #0b1220;
      --text: #e6eef8;
      --muted: #b0b8c9;
    }
    [data-theme="light"] {
      --bg: #f4f7fb;
      --card: #fff;
      --text: #1a2233;
      --muted: #6b7280;
    }
    body {
      background: linear-gradient(180deg, var(--bg), #021021);
      color: var(--text);
      transition: background 0.3s, color 0.3s;
      font-family: Inter, Arial, sans-serif;
    }
    .site-header {
      background: var(--card);
      box-shadow: 0 2px 8px rgba(31,38,135,0.08);
    }
    .main-nav a, .header-actions a {
      color: var(--accent);
      font-weight: 600;
      text-decoration: none;
      margin-right: 12px;
      transition: color 0.2s;
    }
    .main-nav a:hover, .header-actions a:hover {
      color: var(--accent-2);
    }
    [data-theme="light"] .main-nav a, [data-theme="light"] .header-actions a {
      color: #2563eb;
    }
    [data-theme="light"] .main-nav a:hover, [data-theme="light"] .header-actions a:hover {
      color: #7c3aed;
    }
    .theme-toggle-btn {
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 6px 14px;
      margin-left: 10px;
      cursor: pointer;
      font-weight: 600;
      transition: background 0.2s;
    }
    .theme-toggle-btn:hover {
      background: var(--accent-2);
    }
    .chat-wrap{display:flex;gap:16px}
    .chat-list{width:320px;max-height:70vh;overflow:auto;padding:8px;background:var(--card);border-radius:8px}
    .chat-window{flex:1;display:flex;flex-direction:column;max-height:70vh}
    .messages{flex:1;overflow:auto;padding:12px;background:rgba(0,0,0,0.03);border-radius:8px}
    .msg{margin-bottom:10px;padding:8px;border-radius:8px}
    .msg.me{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#022;text-align:right}
    .msg.other{background:rgba(255,255,255,0.02);color:var(--text)}
    .composer{display:flex;gap:8px;margin-top:8px}
    .composer textarea{flex:1}
  </style>
</head>
<body>
  <header class="site-header">
    <aside id="notificationSidebar" style="position:fixed;right:-340px;top:0;height:100vh;width:320px;background:var(--card,#181f2a);box-shadow:-2px 0 8px #0002;z-index:1000;transition:right 0.3s;overflow-y:auto;padding:18px 16px 16px 16px;display:flex;flex-direction:column;gap:12px">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <span style="font-weight:700;font-size:1.2rem">Notificaciones</span>
        <button id="closeSidebarBtn" class="btn ghost" style="font-size:1.2rem">√ó</button>
      </div>
      <div style="margin-bottom:12px">
        <label for="tgChannelInput" style="font-size:0.95rem;color:#888">Canal Telegram para notificaciones</label>
        <input id="tgChannelInput" type="text" placeholder="@micanal o -100123456789" style="width:100%;margin-top:4px" />
        <button id="saveTgChannelBtn" class="btn" style="margin-top:6px">Guardar canal</button>
        <span id="tgChannelStatus" style="margin-left:8px;color:#888"></span>
      </div>
      <div id="notificationList"></div>
    </aside>
    <button id="openSidebarBtn" style="position:fixed;right:12px;top:60px;z-index:1001;background:var(--owner-color,#1e90ff);color:#fff;border:none;border-radius:8px;padding:10px 16px;font-size:1.1rem;box-shadow:0 2px 8px #0002;cursor:pointer">üîî</button>
    <div class="header-inner">
      <a class="brand" href="index.html"><img src="logo.svg" class="logo" alt="DBTeam"/> <span>DBTeam</span></a>
      <nav class="main-nav" aria-label="Main navigation">
        <a href="index.html">Inicio</a>
        <a href="chat.html">Chat</a>
        <a href="telegram.html">Telegram</a>
        <a href="monitor.html">Monitor</a>
        <a href="traducciones.html">Traducciones</a>
        <button id="forceTranslateBtn" style="display:none;margin-left:12px">Forzar traducci√≥n autom√°tica</button>
        <a href="links.html">Enlaces</a>
        <a href="status.html">Estado</a>
        <a href="bot_settings.html">Bots</a>
        <a href="owner.html">Owner</a>
      </nav>
      <div class="header-actions">
        <a href="login.html" class="btn">Login</a>
        <a href="register.html" class="btn ghost">Registro</a>
      </div>
      <button class="nav-toggle" aria-label="Abrir men√∫">‚ò∞</button>
    </div>
  </header>
  <script>
    // Tema: claro/oscuro con persistencia
    function setTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      localStorage.setItem('theme', theme);
      var btn = document.getElementById('themeToggleBtn');
      if (btn) btn.textContent = theme === 'light' ? 'üåô' : '‚òÄÔ∏è';
    }
    function toggleTheme() {
      const current = document.documentElement.getAttribute('data-theme') || 'dark';
      setTheme(current === 'dark' ? 'light' : 'dark');
    }
    document.addEventListener('DOMContentLoaded', function() {
      const saved = localStorage.getItem('theme') || 'dark';
      setTheme(saved);
      var btn = document.getElementById('themeToggleBtn');
      if (btn) btn.addEventListener('click', toggleTheme);
    });
  </script>

  <main class="container">
    <section class="info-card" style="background:linear-gradient(90deg,#2563eb22,#7c3aed22);border-radius:12px;padding:18px 22px;margin-bottom:18px;box-shadow:0 2px 8px #0001;display:flex;align-items:center;gap:18px">
      <img src="logo.svg" alt="DBTeam" style="width:48px;height:48px;border-radius:8px;box-shadow:0 2px 8px #0002">
      <div>
        <h2 style="margin:0 0 6px 0;font-size:1.25em;color:var(--accent)">Chat en tiempo real DBTeam</h2>
        <div style="color:var(--muted);font-size:1.05em">
          Env√≠a y recibe mensajes en tiempo real con tu bot o grupo.<br>
          <ul style="margin:6px 0 0 18px;padding:0;color:var(--muted);font-size:0.98em">
            <li>Conecta usando tu <b>API Key</b> o token de sesi√≥n.</li>
            <li>Selecciona el <b>chat_id</b> para interactuar con diferentes grupos o usuarios.</li>
            <li>Soporte para <b>mensajes multimedia</b> y <b>notificaciones</b>.</li>
            <li>Recarga la lista de chats y mensajes en cualquier momento.</li>
            <li>¬°Prueba el modo oscuro/claro con el bot√≥n üåô/‚òÄÔ∏è!</li>
          </ul>
        </div>
      </div>
    </section>

    <label for="apiBaseChat">API base:</label>
    <input id="apiBaseChat" type="text" value="http://localhost:8081" />

    <label for="apiKeyChat">API Key:</label>
    <input id="apiKeyChat" type="text" placeholder="Token o API key" />

    <div class="chat-wrap">
      <div class="chat-list">
        <label for="chatSelector">Chats recientes</label>
        <select id="chatSelector" size="10" style="width:100%"></select>
        <div style="margin-top:8px;">
          <button id="refreshChats">Refrescar</button>
        </div>
      </div>

      <div class="chat-window">
        <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px">
          <label for="chatIdInput">Chat ID:</label>
          <input id="chatIdInput" type="text" style="width:200px" />
          <label for="sendAsChat">Enviar como:</label>
          <select id="sendAsChat"><option value="user">Usuario</option><option value="bot">Bot</option><option value="ai">IA</option></select>
          <label for="deviceSelectChat">Device:</label>
          <select id="deviceSelectChat"><option value="">(usar BOT_TOKEN)</option></select>
        </div>

        <div class="messages" id="messages"></div>

        <div class="composer">
          <textarea id="compose" rows="3" placeholder="Escribe tu mensaje..."></textarea>
          <div style="display:flex;flex-direction:column;gap:8px">
            <button id="sendMessage">Enviar</button>
            <button id="clearChat" class="secondary">Limpiar</button>
          </div>
        </div>
      </div>
    </div>

    <footer>
      <small class="hint">Nota: el chat usa polling cada 1.5s para actualizar mensajes.</small>
    </footer>
  </main>
  <script src="chat.js"></script>
  <script src="chat_ai.js"></script>
  <!-- Settings modal -->
  <div id="settingsPanel" class="full-lock-overlay hidden" aria-hidden="true">
    <div class="full-lock-box" style="max-width:760px;text-align:left">
      <h2>Ajustes del bot</h2>
      <p class="site-brand-sub">Gestiona roles y revisa las funciones implementadas.</p>
      <div style="margin-top:12px">
        <div style="display:flex;gap:8px;margin-bottom:10px">
          <button id="tabRoles" class="btn">Roles</button>
          <button id="tabExplain" class="btn ghost">Explicaci√≥n</button>
        </div>
        <div id="rolesContent">
          <div style="display:flex;gap:12px">
            <div style="flex:1">
              <label>Propietario (user id o @username)</label>
              <input id="ownerInput" style="width:100%;padding:8px;margin-top:6px;border-radius:6px;border:1px solid rgba(0,0,0,0.08)" placeholder="ej. @andrea7221 o 123456789" />
              <div style="margin-top:8px">
                <label>Admins (separados por comas)</label>
                <input id="adminsInput" style="width:100%;padding:8px;margin-top:6px;border-radius:6px;border:1px solid rgba(0,0,0,0.08)" placeholder="admin1,admin2,@user" />
              </div>
              <div style="margin-top:10px;display:flex;gap:8px">
                <button id="saveRolesBtn" class="btn">Guardar roles</button>
                <button id="clearRolesBtn" class="btn ghost">Borrar</button>
              </div>
            </div>
            <div style="flex:1">
              <label>Funciones implementadas</label>
              <div id="featuresList" style="margin-top:6px;background:var(--card);padding:8px;border-radius:8px;max-height:260px;overflow:auto"></div>
              <div style="margin-top:12px">
                <label>Verificar Bot y sincronizar</label>
                <form id="verifyTokenForm" style="margin-top:6px;display:flex;flex-direction:column;gap:6px">
                  <input id="verifyTokenInput" placeholder="Bot token (ej: 123:ABC...)" style="padding:8px;border-radius:6px;border:1px solid rgba(0,0,0,0.08)" />
                  <input id="verifyDeviceId" placeholder="Device id (opcional)" style="padding:8px;border-radius:6px;border:1px solid rgba(0,0,0,0.08)" />
                  <input id="verifyDeviceName" placeholder="Nombre (opcional)" style="padding:8px;border-radius:6px;border:1px solid rgba(0,0,0,0.08)" />
                  <div style="display:flex;gap:8px">
                    <button type="submit" class="btn">Verificar y sincronizar</button>
                    <button type="button" id="importDataBtn" class="btn ghost">Importar datos</button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
        <div id="explainContent" style="display:none;margin-top:8px">
          <h3>Explicaci√≥n de las funciones</h3>
          <p class="site-brand-sub">En esta pesta√±a se muestran las funciones implementadas y al activarla el panel de chat se ocultar√° para centrar la vista en la documentaci√≥n/controles.</p>
          <h4 style="margin-top:12px">Comandos b√°sicos</h4>
          <div id="commandsList" style="margin-top:6px;background:var(--card);padding:10px;border-radius:8px;max-height:160px;overflow:auto"></div>
          <div id="explainList" style="margin-top:8px;background:var(--card);padding:10px;border-radius:8px;max-height:260px;overflow:auto"></div>
          <div style="margin-top:10px">
            <button id="restoreChatBtn" class="btn ghost">Mostrar panel de chat</button>
          </div>
        </div>
      </div>
      <div style="margin-top:12px;text-align:right">
        <button id="closeSettings" class="btn ghost">Cerrar</button>
      </div>
    </div>
  </div>
  <script src="app.js"></script>
  <script src="shared.js"></script>
  <script src="owner.js"></script>

  <!-- Bubble side panel (shared) -->
  <aside class="bubble-panel" id="bubblePanel" aria-hidden="true">
    <button class="bubble-toggle" id="bubbleToggle" aria-label="Abrir panel">
      <img src="logo.svg" alt="logo" class="bubble-logo"/>
    </button>
    <div class="bubble-body" id="bubbleBody">
      <div class="bubble-header">
        <div class="bubble-title">DBTeam</div>
        <button id="bubbleClose" class="bubble-close" aria-label="Cerrar">‚úï</button>
      </div>
      <nav class="bubble-nav">
        <a href="chat.html">Chat</a>
        <a href="monitor.html">Monitor</a>
        <a href="#" id="linkSettings">Ajustes</a>
        <a href="#" id="linkAI">IA (endpoint)</a>
        <a href="#" id="linkDevices">Dispositivos</a>
        <a href="#" id="linkBackup">Backup/Restore</a>
      </nav>
      <div id="bubbleResources" style="margin-top:8px;padding-top:8px;border-top:1px solid rgba(255,255,255,0.02)"></div>
      <div class="bubble-footer">
        <button id="logoutBtn" class="secondary">Salir</button>
      </div>
    </div>
  </aside>
</body>
</html>
